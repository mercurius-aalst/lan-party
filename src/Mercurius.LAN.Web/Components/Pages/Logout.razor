@page "/logout"
@using Microsoft.AspNetCore.Http
@using Refit
@inject NavigationManager NavigationManager
@inject IToastService ToastService
@inject IAuthService AuthService

@code {
    [CascadingParameter] private HttpContext? HttpContext { get; set; }


    protected override async Task OnInitializedAsync()
    {
        try
        {
            await AuthService.LogoutAsync();

            // Remove cookies
            HttpContext.Response.Cookies.Delete("access_token");
            HttpContext.Response.Cookies.Delete("refresh_token");

            await InvokeAsync(StateHasChanged);
            ToastService.ShowInfo("You have successfully logged out.");

            NavigationManager.NavigateTo("/login", true);
        }
        catch(ApiException ex)
        {
            ToastService.ShowError(ex.Content);
        }
    }
}